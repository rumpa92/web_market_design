<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saved Addresses - StyleHub</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Header Section -->
    <div class="profile-page-header">
        <div class="container">
            <div class="profile-header-content">
                <button class="back-button" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1 class="profile-page-title">Saved Addresses</h1>
                <button class="add-address-button" onclick="showAddAddressForm()" id="addAddressButton">
                    <i class="fas fa-plus"></i>
                    Add New
                </button>
            </div>
        </div>
    </div>

    <!-- Saved Addresses Content -->
    <main class="saved-addresses-main">
        <div class="container">
            <!-- Loading State -->
            <div id="loadingState" class="loading-state hidden">
                <div class="loading-spinner"></div>
                <p>Saving address...</p>
            </div>

            <!-- Addresses List -->
            <div id="addressesList" class="addresses-list">
                <!-- Addresses will be dynamically populated here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state hidden">
                <div class="empty-state-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <h3>No saved addresses yet</h3>
                <p>Add your first address to get started with faster checkout</p>
                <button class="add-first-address-btn" onclick="showAddAddressForm()">
                    <i class="fas fa-plus"></i>
                    Add Your First Address
                </button>
            </div>
        </div>
    </main>

    <!-- Add/Edit Address Modal -->
    <div id="addressModal" class="address-modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Address</h3>
                <button class="close-modal" onclick="closeAddressModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addressForm" class="address-form">
                    <input type="hidden" id="addressId" name="addressId">
                    
                    <div class="form-group">
                        <label for="fullName" class="form-label">Full Name</label>
                        <input type="text" id="fullName" name="fullName" class="form-input" required>
                        <div class="error-message" id="fullNameError"></div>
                    </div>

                    <div class="form-group">
                        <label for="mobile" class="form-label">Mobile Number</label>
                        <input type="tel" id="mobile" name="mobile" class="form-input" required>
                        <div class="error-message" id="mobileError"></div>
                    </div>

                    <div class="form-group">
                        <label for="pincode" class="form-label">Pincode</label>
                        <input type="text" id="pincode" name="pincode" class="form-input" maxlength="6" required>
                        <div class="error-message" id="pincodeError"></div>
                    </div>

                    <div class="form-group">
                        <label for="addressLine1" class="form-label">Address Line 1</label>
                        <input type="text" id="addressLine1" name="addressLine1" class="form-input" placeholder="House No., Building, Street" required>
                        <div class="error-message" id="addressLine1Error"></div>
                    </div>

                    <div class="form-group">
                        <label for="addressLine2" class="form-label">Address Line 2 (Optional)</label>
                        <input type="text" id="addressLine2" name="addressLine2" class="form-input" placeholder="Landmark, Area">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="city" class="form-label">City</label>
                            <input type="text" id="city" name="city" class="form-input" required>
                            <div class="error-message" id="cityError"></div>
                        </div>

                        <div class="form-group">
                            <label for="state" class="form-label">State</label>
                            <select id="state" name="state" class="form-select" required>
                                <option value="">Select State</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                                <option value="Delhi">Delhi</option>
                            </select>
                            <div class="error-message" id="stateError"></div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Address Type</label>
                        <div class="address-type-group">
                            <label class="address-type-option">
                                <input type="radio" name="addressType" value="Home" checked>
                                <span class="address-type-custom">
                                    <i class="fas fa-home"></i>
                                    Home
                                </span>
                            </label>
                            <label class="address-type-option">
                                <input type="radio" name="addressType" value="Work">
                                <span class="address-type-custom">
                                    <i class="fas fa-briefcase"></i>
                                    Work
                                </span>
                            </label>
                            <label class="address-type-option">
                                <input type="radio" name="addressType" value="Other">
                                <span class="address-type-custom">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Other
                                </span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="isDefault" name="isDefault">
                            <span class="checkbox-custom"></span>
                            Make this my default address
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="cancel-button" onclick="closeAddressModal()">
                            Cancel
                        </button>
                        <button type="submit" class="save-address-button">
                            <i class="fas fa-check"></i>
                            Save Address
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="delete-modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Delete Address</h3>
            </div>
            <div class="modal-body">
                <div class="delete-confirmation">
                    <div class="delete-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <p>Are you sure you want to delete this address? This action cannot be undone.</p>
                </div>
                <div class="delete-actions">
                    <button class="cancel-delete-btn" onclick="closeDeleteModal()">Cancel</button>
                    <button class="confirm-delete-btn" onclick="confirmDelete()">
                        <i class="fas fa-trash"></i>
                        Delete Address
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        let addresses = [];
        let editingAddressId = null;
        let deleteAddressId = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedAddresses();
            setupFormValidation();
            setupPincodeValidation();
        });

        function goBack() {
            window.location.href = 'profile.html';
        }

        function loadSavedAddresses() {
            // Load addresses from localStorage
            const savedAddresses = localStorage.getItem('userAddresses');
            if (savedAddresses) {
                addresses = JSON.parse(savedAddresses);
            } else {
                // Initialize with sample addresses for demonstration
                addresses = [
                    {
                        id: '1',
                        fullName: 'Rumpa Samanta',
                        mobile: '+91 9876543210',
                        addressLine1: 'Flat 302, Sunrise Apartments',
                        addressLine2: 'Park Street',
                        city: 'Kolkata',
                        state: 'West Bengal',
                        pincode: '700016',
                        addressType: 'Home',
                        isDefault: true
                    },
                    {
                        id: '2',
                        fullName: 'Rumpa Samanta',
                        mobile: '+91 9876543210',
                        addressLine1: 'Tech Tower, 5th Floor',
                        addressLine2: 'Salt Lake City',
                        city: 'Kolkata',
                        state: 'West Bengal',
                        pincode: '700091',
                        addressType: 'Work',
                        isDefault: false
                    }
                ];
                saveAddresses();
            }

            displayAddresses();
        }

        function saveAddresses() {
            localStorage.setItem('userAddresses', JSON.stringify(addresses));
        }

        function displayAddresses() {
            const addressesList = document.getElementById('addressesList');
            const emptyState = document.getElementById('emptyState');

            if (addresses.length === 0) {
                addressesList.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            addressesList.classList.remove('hidden');

            addressesList.innerHTML = addresses.map(address => `
                <div class="address-card ${address.isDefault ? 'default-address' : ''}" data-id="${address.id}">
                    <div class="address-header">
                        <div class="address-type-badge ${address.addressType.toLowerCase()}">
                            <i class="fas fa-${getAddressTypeIcon(address.addressType)}"></i>
                            ${address.addressType}
                        </div>
                        ${address.isDefault ? '<div class="default-badge">Default</div>' : ''}
                    </div>
                    
                    <div class="address-content">
                        <h4 class="address-name">${address.fullName}</h4>
                        <p class="address-phone">
                            <i class="fas fa-phone"></i>
                            ${address.mobile}
                        </p>
                        <p class="address-text">
                            ${address.addressLine1}${address.addressLine2 ? ', ' + address.addressLine2 : ''}<br>
                            ${address.city}, ${address.state} - ${address.pincode}
                        </p>
                    </div>
                    
                    <div class="address-actions">
                        <button class="action-btn edit-btn" onclick="editAddress('${address.id}')" title="Edit Address">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn delete-btn" onclick="showDeleteModal('${address.id}')" title="Delete Address">
                            <i class="fas fa-trash"></i>
                        </button>
                        ${!address.isDefault ? `<button class="action-btn default-btn" onclick="setAsDefault('${address.id}')" title="Set as Default">
                            <i class="fas fa-check-circle"></i>
                        </button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getAddressTypeIcon(type) {
            switch(type) {
                case 'Home': return 'home';
                case 'Work': return 'briefcase';
                case 'Other': return 'map-marker-alt';
                default: return 'map-marker-alt';
            }
        }

        function showAddAddressForm() {
            editingAddressId = null;
            document.getElementById('modalTitle').textContent = 'Add New Address';
            document.getElementById('addressForm').reset();
            document.getElementById('addressModal').classList.remove('hidden');
            document.getElementById('fullName').focus();
        }

        function editAddress(addressId) {
            const address = addresses.find(addr => addr.id === addressId);
            if (!address) return;

            editingAddressId = addressId;
            document.getElementById('modalTitle').textContent = 'Edit Address';
            
            // Populate form with address data
            document.getElementById('addressId').value = address.id;
            document.getElementById('fullName').value = address.fullName;
            document.getElementById('mobile').value = address.mobile;
            document.getElementById('pincode').value = address.pincode;
            document.getElementById('addressLine1').value = address.addressLine1;
            document.getElementById('addressLine2').value = address.addressLine2 || '';
            document.getElementById('city').value = address.city;
            document.getElementById('state').value = address.state;
            document.getElementById('isDefault').checked = address.isDefault;

            // Set address type radio button
            const addressTypeRadio = document.querySelector(`input[name="addressType"][value="${address.addressType}"]`);
            if (addressTypeRadio) {
                addressTypeRadio.checked = true;
            }

            document.getElementById('addressModal').classList.remove('hidden');
        }

        function closeAddressModal() {
            document.getElementById('addressModal').classList.add('hidden');
            document.getElementById('addressForm').reset();
            clearAllErrors();
            editingAddressId = null;
        }

        function setupFormValidation() {
            const form = document.getElementById('addressForm');
            const inputs = form.querySelectorAll('.form-input, .form-select');
            
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });
                
                input.addEventListener('input', function() {
                    clearFieldError(this);
                });
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateForm()) {
                    saveAddress();
                }
            });
        }

        function setupPincodeValidation() {
            const pincodeInput = document.getElementById('pincode');
            pincodeInput.addEventListener('input', function() {
                // Auto-fill city and state based on pincode (simplified)
                const pincode = this.value;
                if (pincode.length === 6) {
                    // In a real app, this would be an API call
                    autoFillLocation(pincode);
                }
            });
        }

        function autoFillLocation(pincode) {
            // Simplified auto-fill logic (in real app, use pincode API)
            const locationData = {
                '700016': { city: 'Kolkata', state: 'West Bengal' },
                '700091': { city: 'Kolkata', state: 'West Bengal' },
                '110001': { city: 'New Delhi', state: 'Delhi' },
                '400001': { city: 'Mumbai', state: 'Maharashtra' },
                '560001': { city: 'Bangalore', state: 'Karnataka' }
            };

            const location = locationData[pincode];
            if (location) {
                document.getElementById('city').value = location.city;
                document.getElementById('state').value = location.state;
            }
        }

        function validateField(field) {
            const fieldName = field.name;
            const value = field.value.trim();
            let isValid = true;
            let errorMessage = '';

            switch(fieldName) {
                case 'fullName':
                    if (!value) {
                        errorMessage = 'Full name is required';
                        isValid = false;
                    } else if (value.length < 2) {
                        errorMessage = 'Name must be at least 2 characters';
                        isValid = false;
                    }
                    break;
                
                case 'mobile':
                    const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
                    if (!value) {
                        errorMessage = 'Mobile number is required';
                        isValid = false;
                    } else if (!phoneRegex.test(value.replace(/[\s\-\(\)]/g, ''))) {
                        errorMessage = 'Please enter a valid mobile number';
                        isValid = false;
                    }
                    break;
                
                case 'pincode':
                    const pincodeRegex = /^[1-9][0-9]{5}$/;
                    if (!value) {
                        errorMessage = 'Pincode is required';
                        isValid = false;
                    } else if (!pincodeRegex.test(value)) {
                        errorMessage = 'Please enter a valid 6-digit pincode';
                        isValid = false;
                    }
                    break;
                
                case 'addressLine1':
                    if (!value) {
                        errorMessage = 'Address line 1 is required';
                        isValid = false;
                    } else if (value.length < 5) {
                        errorMessage = 'Please enter a complete address';
                        isValid = false;
                    }
                    break;
                
                case 'city':
                    if (!value) {
                        errorMessage = 'City is required';
                        isValid = false;
                    }
                    break;
                
                case 'state':
                    if (!value) {
                        errorMessage = 'State is required';
                        isValid = false;
                    }
                    break;
            }

            showFieldError(field, isValid ? '' : errorMessage);
            return isValid;
        }

        function validateForm() {
            const form = document.getElementById('addressForm');
            const inputs = form.querySelectorAll('.form-input[required], .form-select[required]');
            let isValid = true;

            inputs.forEach(input => {
                if (!validateField(input)) {
                    isValid = false;
                }
            });

            return isValid;
        }

        function showFieldError(field, message) {
            const errorElement = document.getElementById(field.name + 'Error');
            if (errorElement) {
                errorElement.textContent = message;
                if (message) {
                    field.classList.add('error');
                } else {
                    field.classList.remove('error');
                }
            }
        }

        function clearFieldError(field) {
            showFieldError(field, '');
        }

        function clearAllErrors() {
            const form = document.getElementById('addressForm');
            const inputs = form.querySelectorAll('.form-input, .form-select');
            inputs.forEach(input => clearFieldError(input));
        }

        function saveAddress() {
            if (!validateForm()) return;

            showLoadingState();

            const formData = new FormData(document.getElementById('addressForm'));
            const addressData = {
                fullName: formData.get('fullName'),
                mobile: formData.get('mobile'),
                pincode: formData.get('pincode'),
                addressLine1: formData.get('addressLine1'),
                addressLine2: formData.get('addressLine2') || '',
                city: formData.get('city'),
                state: formData.get('state'),
                addressType: formData.get('addressType'),
                isDefault: formData.get('isDefault') === 'on'
            };

            // Simulate API call
            setTimeout(() => {
                try {
                    if (editingAddressId) {
                        // Update existing address
                        const addressIndex = addresses.findIndex(addr => addr.id === editingAddressId);
                        if (addressIndex !== -1) {
                            addresses[addressIndex] = { ...addressData, id: editingAddressId };
                        }
                    } else {
                        // Add new address
                        addressData.id = Date.now().toString();
                        addresses.push(addressData);
                    }

                    // If this address is set as default, remove default from others
                    if (addressData.isDefault) {
                        addresses.forEach(addr => {
                            if (addr.id !== addressData.id) {
                                addr.isDefault = false;
                            }
                        });
                    }

                    saveAddresses();
                    hideLoadingState();
                    
                    const action = editingAddressId ? 'updated' : 'saved';
                    showNotification(`Address ${action} successfully!`, 'success');
                    
                    closeAddressModal();
                    displayAddresses();

                } catch (error) {
                    hideLoadingState();
                    showNotification('Failed to save address. Please try again.', 'error');
                }
            }, 1500);
        }

        function setAsDefault(addressId) {
            // Remove default from all addresses
            addresses.forEach(addr => {
                addr.isDefault = false;
            });

            // Set the selected address as default
            const address = addresses.find(addr => addr.id === addressId);
            if (address) {
                address.isDefault = true;
                saveAddresses();
                displayAddresses();
                showNotification('Default address updated successfully!', 'success');
            }
        }

        function showDeleteModal(addressId) {
            deleteAddressId = addressId;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            deleteAddressId = null;
        }

        function confirmDelete() {
            if (!deleteAddressId) return;

            const addressIndex = addresses.findIndex(addr => addr.id === deleteAddressId);
            if (addressIndex !== -1) {
                const deletedAddress = addresses[addressIndex];
                addresses.splice(addressIndex, 1);

                // If deleted address was default, set first address as default
                if (deletedAddress.isDefault && addresses.length > 0) {
                    addresses[0].isDefault = true;
                }

                saveAddresses();
                displayAddresses();
                showNotification('Address deleted successfully!', 'success');
            }

            closeDeleteModal();
        }

        function showLoadingState() {
            document.getElementById('loadingState').classList.remove('hidden');
            document.querySelector('.saved-addresses-main').style.opacity = '0.5';
        }

        function hideLoadingState() {
            document.getElementById('loadingState').classList.add('hidden');
            document.querySelector('.saved-addresses-main').style.opacity = '1';
        }

        // Notification function
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>
